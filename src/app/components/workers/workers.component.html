<h2>Workers List</h2>

<div *ngIf="validationErrors.length > 0" class="error-overlay">
  <div class="error-box">
    <h3>Validation Errors</h3>
    <ul>
      <li *ngFor="let error of validationErrors">{{ error }}</li>
    </ul>
    <button (click)="clearValidationErrors()" class="btn close-btn">Close</button>
  </div>
</div>

<div class="filter-container" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
  <label> Salary:
    <input type="number" [(ngModel)]="salaryFilter" (input)="applyFilters()" />
  </label>
  <label> Experience:
    <input type="number" [(ngModel)]="experienceFilter" (input)="applyFilters()" />
  </label>
  <label> Age:
    <input type="number" [(ngModel)]="ageFilter" (input)="applyFilters()" />
  </label>
  <button (click)="resetFilters()" class="btn reset">♻️ Reset Filters</button>

  <div style="margin-left: auto;">
    <button (click)="addWorker()" class="btn add">➕ Add Worker</button>
  </div>
</div>

<table class="worker-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Surname</th>
      <th>Salary</th>
      <th>Experience (Years)</th>
      <th>Date of Birth</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let worker of filteredWorkers; let i = index">
      <td>{{ worker.id }}</td>

      <td>
        <input *ngIf="editingIndex === i" [(ngModel)]="worker.name" />
        <span *ngIf="editingIndex !== i">{{ worker.name }}</span>
      </td>

      <td>
        <input *ngIf="editingIndex === i" [(ngModel)]="worker.surname" />
        <span *ngIf="editingIndex !== i">{{ worker.surname }}</span>
      </td>

      <td>
        <input *ngIf="editingIndex === i" type="number" [(ngModel)]="worker.salary" />
        <span *ngIf="editingIndex !== i">{{ worker.salary | currency:'USD' }}</span>
      </td>

      <td>
        <input *ngIf="editingIndex === i" type="number" [(ngModel)]="worker.workExperienceYears" />
        <span *ngIf="editingIndex !== i">{{ worker.workExperienceYears }}</span>
      </td>

      <td>
        <input
          *ngIf="editingIndex === i"
          type="date"
          [ngModel]="formatDateForInput(worker.dateOfBirth)"
          (ngModelChange)="worker.dateOfBirth = $event"
        />
        <span *ngIf="editingIndex !== i">{{ worker.dateOfBirth | date:'dd.MM.yyyy' }}</span>
      </td>

      <td>
        <button *ngIf="editingIndex !== i" (click)="editWorker(i)" class="btn edit">✏️</button>
        <button *ngIf="editingIndex === i" (click)="saveWorker(i)" class="btn save">💾</button>
        <button *ngIf="editingIndex === i" (click)="cancelEdit(i)" class="btn cancel">❌</button>
        <button (click)="deleteWorker(worker)" class="btn delete">🗑️</button>
      </td>
    </tr>
  </tbody>
</table>
